# üì¶ Documentaci√≥n - Pipeline Microfrontend Gitlab

Este pipeline est√° dise√±ado para ejecutarse en diferentes ambientes (`desarrollo`, `calidad` y `producci√≥n`) dependiendo de los inputs o eventos de GitHub. A continuaci√≥n, se detalla c√≥mo se ejecuta cada uno y qu√© hace.

---

## üß™ Desarrollo

### ¬øC√≥mo se ejecuta?
El pipeline de desarrollo se activa al **ejecutar el workflow manualmente** (mediante `workflow_dispatch` o `workflow_call`) pasando el nombre de un branch (`develop`, `feature/*`, etc.) en el par√°metro `branch_or_tag`, y estableciendo el `input.environment` como `desarrollo`.

### ¬øQu√© hace?
Cuando el `input.environment` es igual a `desarrollo`, se ejecutan los siguientes jobs:

#### Jobs ejecutados:
- `set-environment`: Determina el entorno a partir del branch.
- `build-node`: Construye el microfrontend usando Node.js.
- `sonarqube-unit-tests`: Ejecuta an√°lisis est√°tico y pruebas unitarias con SonarQube.
- `snyk_SCA`: Ejecuta an√°lisis de dependencias (SCA) con Snyk.
- `snyk_SAST`: Ejecuta an√°lisis de seguridad de c√≥digo est√°tico (SAST) con Snyk.

> üí° Nota: El job `sonarqube` est√° presente pero deshabilitado (`if: false`).

---

## ‚úÖ Calidad

### ¬øC√≥mo se ejecuta?
El pipeline de calidad se activa autom√°ticamente al **crear un Pull Request cuya base sea la rama `calidad`**.

### ¬øQu√© hace?
Cuando el evento `pull_request` apunta a la rama `calidad`, se ejecuta:

#### Jobs ejecutados:
- `set-environment`: Establece el ambiente en base al destino del PR.
- `pre-release`: Ejecuta la pre-liberaci√≥n para validaci√≥n previa al pase a producci√≥n.

---

## üöÄ Producci√≥n

### ¬øC√≥mo se ejecuta?
El pipeline de producci√≥n se activa al **ejecutar el workflow manualmente** y pasar un `tag` en el par√°metro `branch_or_tag`, estableciendo el `input.environment` como `produccion`.

### ¬øQu√© hace?
Cuando el `input.environment` es igual a `produccion`, se ejecutan:

#### Jobs ejecutados:
- `set-environment`: Establece el entorno productivo.
- `release`: Lanza la versi√≥n del microfrontend usando el tag proporcionado.

> üîÅ Luego de `release`, podr√≠an ejecutarse despliegues (actualmente deshabilitados):

- `deploy-to-azure-app-service`: Despliegue a Azure App Service (`if: false`).
- `deploy-to-azure-blob-storage-cdn`: Se ejecuta si `project == 'xdig'`.

---

## üìÇ Jobs por Ambiente

| Ambiente     | Jobs ejecutados                                                                 |
|--------------|----------------------------------------------------------------------------------|
| desarrollo   | set-environment, build-node, sonarqube-unit-tests, snyk_SCA, snyk_SAST          |
| calidad      | set-environment, pre-release                                                    |
| producci√≥n   | set-environment, release (opcional: deploy-to-azure-app-service, blob-storage)  |

---

## üßæ Inputs del Workflow

- `project`: Nombre del proyecto (ej: `xdig`).
- `deploy_on`: Plataforma de despliegue (`app-service`, `blob-storage`, etc.).
- `environment`: Ambiente destino (`desarrollo`, `calidad`, `produccion`).
- `branch_or_tag`: Branch o Tag a trabajar/desplegar.
- `npm-install-flags`: Flags personalizados para `npm install`.

---

## üîí Secrets requeridos

| Secret                    | Descripci√≥n                                       |
|---------------------------|---------------------------------------------------|
| `GH_PAT`                 | Token de acceso personal a GitHub (obligatorio).  |
| `AZURE_STORAGE_USERNAME` | Usuario de cuenta de Azure (opcional).            |
| `AZURE_STORAGE_PASSWORD` | Contrase√±a de Azure Storage (opcional).           |
| `SNYK_TOKEN`             | Token para an√°lisis con Snyk.                     |
| `SONAR_TOKEN`            | Token de autenticaci√≥n para SonarQube.            |
| `SONAR_HOST_URL`         | URL del host de SonarQube.                        |
| `AZURE_CLIENT_ID`, `AZURE_CLIENT_SECRET`, `AZURE_TENANT_ID`, `AZURE_STORAGE_KEY` | Requeridos para despliegues en Azure. |

---

## üß† Notas adicionales

- El job `set-environment` determina el entorno a partir del `branch_or_tag` o del destino del Pull Request.
- El job `deploy-to-azure-app-service` actualmente est√° deshabilitado (`if: false`), pero se puede habilitar para despliegues en Azure App Service.
- El job `deploy-to-azure-blob-storage-cdn` solo se ejecuta si el input `project` es `xdig`.

